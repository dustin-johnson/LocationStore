/*
 * jQuery Impromptu
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 4.2
 * Last Modified: 01/25/2013
 * 
 * Copyright 2013 Trent Richardson
 * You may use this project under MIT or GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 * 
 */
 /*
 * jQuery Impromptu
 * By: Trent Richardson [http://trentrichardson.com]
 * Version 4.2
 * Last Modified: 01/25/2013
 * 
 * Copyright 2013 Trent Richardson
 * You may use this project under MIT or GPL licenses.
 * http://trentrichardson.com/Impromptu/GPL-LICENSE.txt
 * http://trentrichardson.com/Impromptu/MIT-LICENSE.txt
 * 
 */
 
 (function($){$.prompt=function(h,j){$.prompt.options=$.extend({},$.prompt.defaults,j);$.prompt.currentPrefix=$.prompt.options.prefix;$.prompt.currentStateName="";var l=$(document.body);var m=$(window);$.prompt.options.classes=$.trim($.prompt.options.classes);if($.prompt.options.classes!='')$.prompt.options.classes=' '+$.prompt.options.classes;var n='<div class="'+$.prompt.options.prefix+'box'+$.prompt.options.classes+'">';if($.prompt.options.useiframe&&($('object, applet').length>0)){n+='<iframe src="javascript:false;" style="display:block;position:absolute;z-index:-1;" class="'+$.prompt.options.prefix+'fade"></iframe>'}else{n+='<div class="'+$.prompt.options.prefix+'fade"></div>'}n+='<div class="'+$.prompt.options.prefix+'"><div class="'+$.prompt.options.prefix+'container"><div class="';n+=$.prompt.options.prefix+'close">X</div><div class="'+$.prompt.options.prefix+'states"></div>';n+='</div></div></div>';$.prompt.jqib=$(n).appendTo(l);$.prompt.jqi=$.prompt.jqib.children('.'+$.prompt.options.prefix);$.prompt.jqif=$.prompt.jqib.children('.'+$.prompt.options.prefix+'fade');if(h.constructor==String){h={state0:{title:$.prompt.options.title,html:h,buttons:$.prompt.options.buttons,position:$.prompt.options.position,focus:$.prompt.options.focus,submit:$.prompt.options.submit}}}var o="";$.each(h,function(a,b){b=$.extend({},$.prompt.defaults.state,b);h[a]=b;var c="",title="";if(b.position.arrow!==null)c='<div class="'+$.prompt.options.prefix+'arrow '+$.prompt.options.prefix+'arrow'+b.position.arrow+'"></div>';if(b.title&&b.title!=='')title='<div class="'+$.prompt.options.prefix+'title">'+b.title+'</div>';o+='<div id="'+$.prompt.options.prefix+'state_'+a+'" class="'+$.prompt.options.prefix+'state" style="display:none;">'+c+title;if(b.html!='')o+='<div class="'+$.prompt.options.prefix+'message">'+b.html+'</div>';o+='<div class="'+$.prompt.options.prefix+'buttons">';$.each(b.buttons,function(k,v){if(typeof v=='object'){o+='<button ';if(typeof v.classes!=="undefined"){o+='class="'+($.isArray(v.classes)?v.classes.join(' '):v.classes)+'" '}o+=' name="'+$.prompt.options.prefix+'_'+a+'_button'+v.title.replace(/[^a-z0-9]+/gi,'')+'" id="'+$.prompt.options.prefix+'_'+a+'_button'+v.title.replace(/[^a-z0-9]+/gi,'')+'" value="'+v.value+'">'+v.title+'</button>'}else{o+='<button name="'+$.prompt.options.prefix+'_'+a+'_button'+k+'" id="'+$.prompt.options.prefix+'_'+a+'_button'+k+'" value="'+v+'">'+k+'</button>'}});o+='</div></div>'});$.prompt.states=h;$.prompt.jqi.find('.'+$.prompt.options.prefix+'states').html(o).children('.'+$.prompt.options.prefix+'state:first').css('display','block');$.prompt.jqi.find('.'+$.prompt.options.prefix+'buttons:empty').css('display','none');$.each(h,function(e,f){var g=$.prompt.jqi.find('#'+$.prompt.options.prefix+'state_'+e);if($.prompt.currentStateName==="")$.prompt.currentStateName=e;g.bind('promptsubmit',f.submit);g.children('.'+$.prompt.options.prefix+'buttons').children('button').click(function(){var b=$(this),msg=g.children('.'+$.prompt.options.prefix+'message'),clicked=f.buttons[b.text()]||f.buttons[b.html()];if(clicked==undefined){for(var i in f.buttons)if(f.buttons[i].title==b.text()||f.buttons[i].title==b.html())clicked=f.buttons[i].value}if(typeof clicked=='object')clicked=clicked.value;var c={};$.each($.prompt.jqi.find('.'+$.prompt.options.prefix+'states :input').serializeArray(),function(i,a){if(c[a.name]===undefined){c[a.name]=a.value}else if(typeof c[a.name]==Array||typeof c[a.name]=='object'){c[a.name].push(a.value)}else{c[a.name]=[c[a.name],a.value]}});var d=new $.Event('promptsubmit');d.stateName=e;d.state=g;g.trigger(d,[clicked,msg,c]);if(!d.isDefaultPrevented()){$.prompt.close(true,clicked,msg,c)}});g.find('.'+$.prompt.options.prefix+'buttons button:eq('+f.focus+')').addClass($.prompt.options.prefix+'defaultbutton')});var p=function(){if($.prompt.options.persistent){var b=($.prompt.options.top.toString().indexOf('%')>=0?(m.height()*(parseInt($.prompt.options.top,10)/100)):parseInt($.prompt.options.top,10)),top=parseInt($.prompt.jqi.css('top').replace('px',''),10)-b;$('html,body').animate({scrollTop:top},'fast',function(){var i=0;$.prompt.jqib.addClass($.prompt.options.prefix+'warning');var a=setInterval(function(){$.prompt.jqib.toggleClass($.prompt.options.prefix+'warning');if(i++>1){clearInterval(a);$.prompt.jqib.removeClass($.prompt.options.prefix+'warning')}},100)})}else{$.prompt.close(true)}};var q=function(e){var b=(window.event)?event.keyCode:e.keyCode;if(b==27){p()}if(b==9){var c=$(':input:enabled:visible',$.prompt.jqib);var d=!e.shiftKey&&e.target==c[c.length-1];var f=e.shiftKey&&e.target==c[0];if(d||f){setTimeout(function(){if(!c)return;var a=c[f===true?c.length-1:0];if(a)a.focus()},10);return false}}};$.prompt.position();$.prompt.style();$.prompt.jqif.click(p);m.resize({animate:false},$.prompt.position);$.prompt.jqi.find('.'+$.prompt.options.prefix+'close').click($.prompt.close);$.prompt.jqib.bind("keydown keypress",q).bind('promptloaded',$.prompt.options.loaded).bind('promptclose',$.prompt.options.close).bind('promptstatechanging',$.prompt.options.statechanging).bind('promptstatechanged',$.prompt.options.statechanged);$.prompt.jqif.fadeIn($.prompt.options.overlayspeed);$.prompt.jqi[$.prompt.options.show]($.prompt.options.promptspeed,function(){$.prompt.jqib.trigger('promptloaded')});$.prompt.jqi.find('.'+$.prompt.options.prefix+'states .'+$.prompt.options.prefix+'state:first .'+$.prompt.options.prefix+'defaultbutton').focus();if($.prompt.options.timeout>0)setTimeout($.prompt.close,$.prompt.options.timeout);return $.prompt.jqib};$.prompt.defaults={prefix:'jqi',classes:'',title:'',buttons:{Ok:true},loaded:function(e){},submit:function(e,v,m,f){},close:function(e,v,m,f){},statechanging:function(e,a,b){},statechanged:function(e,a){},opacity:0.6,zIndex:999,overlayspeed:'slow',promptspeed:'fast',show:'fadeIn',focus:0,useiframe:false,top:'15%',position:{container:null,x:null,y:null,arrow:null,width:null},persistent:true,timeout:0,state:{title:'',html:'',buttons:{Ok:true},focus:0,position:{container:null,x:null,y:null,arrow:null,width:null},submit:function(e,v,m,f){return true}}};$.prompt.currentPrefix=$.prompt.defaults.prefix;$.prompt.currentStateName="";$.prompt.setDefaults=function(o){$.prompt.defaults=$.extend({},$.prompt.defaults,o)};$.prompt.setStateDefaults=function(o){$.prompt.defaults.state=$.extend({},$.prompt.defaults.state,o)};$.prompt.position=function(e){var a=$.fx.off,$window=$(window),bodyHeight=$(document.body).outerHeight(true),windowHeight=$(window).height(),documentHeight=$(document).height(),height=bodyHeight>windowHeight?bodyHeight:windowHeight,top=parseInt($window.scrollTop(),10)+($.prompt.options.top.toString().indexOf('%')>=0?(windowHeight*(parseInt($.prompt.options.top,10)/100)):parseInt($.prompt.options.top,10)),pos=$.prompt.states[$.prompt.currentStateName].position;if(e!==undefined&&e.data.animate===false)$.fx.off=true;$.prompt.jqib.css({position:"absolute",height:height,width:"100%",top:0,left:0,right:0,bottom:0});$.prompt.jqif.css({position:"absolute",height:height,width:"100%",top:0,left:0,right:0,bottom:0});if(pos&&pos.container){var b=$(pos.container).offset();if($.isPlainObject(b)&&b.top!==undefined){$.prompt.jqi.css({position:"absolute"});$.prompt.jqi.animate({top:b.top+pos.y,left:b.left+pos.x,marginLeft:0,width:(pos.width!==undefined)?pos.width:null},$.prompt.options.promptspeed);top=(b.top+pos.y)-($.prompt.options.top.toString().indexOf('%')>=0?(windowHeight*(parseInt($.prompt.options.top,10)/100)):parseInt($.prompt.options.top,10));$('html,body').animate({scrollTop:top},0,'swing',function(){})}}else if(pos&&pos.width){$.prompt.jqi.css({position:"absolute",left:'50%'});$.prompt.jqi.animate({top:pos.y||top,left:pos.x||'50%',marginLeft:((pos.width/2)*-1),width:pos.width})}else{$.prompt.jqi.css({position:"absolute",top:top,left:'50%',marginLeft:(($.prompt.jqi.outerWidth()/2)*-1)})}if(e!==undefined&&e.data.animate===false)$.fx.off=a};$.prompt.style=function(){$.prompt.jqif.css({zIndex:$.prompt.options.zIndex,display:"none",opacity:$.prompt.options.opacity});$.prompt.jqi.css({zIndex:$.prompt.options.zIndex+1,display:"none"});$.prompt.jqib.css({zIndex:$.prompt.options.zIndex})};$.prompt.getStateContent=function(a){return $('#'+$.prompt.currentPrefix+'state_'+a)};$.prompt.getCurrentState=function(){return $('.'+$.prompt.currentPrefix+'state:visible')};$.prompt.getCurrentStateName=function(){var a=$.prompt.getCurrentState().attr('id');return a.replace($.prompt.currentPrefix+'state_','')};$.prompt.goToState=function(b,c){var d=new $.Event('promptstatechanging');$.prompt.jqib.trigger(d,[$.prompt.currentStateName,b]);if(!d.isDefaultPrevented()){$.prompt.currentStateName=b;$('.'+$.prompt.currentPrefix+'state').slideUp('slow').find('.'+$.prompt.currentPrefix+'arrow').fadeOut();$('#'+$.prompt.currentPrefix+'state_'+b).slideDown('slow',function(){var a=$(this);a.find('.'+$.prompt.currentPrefix+'defaultbutton').focus();a.find('.'+$.prompt.currentPrefix+'arrow').fadeIn('slow');if(typeof c=='function'){$.prompt.jqib.bind('promptstatechanged.tmp',c)}$.prompt.jqib.trigger('promptstatechanged',[b]);if(typeof c=='function'){$.prompt.jqib.unbind('promptstatechanged.tmp')}});$.prompt.position()}};$.prompt.nextState=function(a){var b=$('#'+$.prompt.currentPrefix+'state_'+$.prompt.currentStateName).next();$.prompt.goToState(b.attr('id').replace($.prompt.currentPrefix+'state_',''),a)};$.prompt.prevState=function(a){var b=$('#'+$.prompt.currentPrefix+'state_'+$.prompt.currentStateName).prev();$.prompt.goToState(b.attr('id').replace($.prompt.currentPrefix+'state_',''),a)};$.prompt.close=function(a,b,c,d){$.prompt.jqib.fadeOut('fast',function(){if(a){$.prompt.jqib.trigger('promptclose',[b,c,d])}$.prompt.jqib.remove();$('window').unbind('resize',$.prompt.position)})};$.fn.extend({prompt:function(a){if(a==undefined)a={};if(a.withDataAndEvents==undefined)a.withDataAndEvents=false;$.prompt($(this).clone(a.withDataAndEvents).html(),a)}})})(jQuery);
 